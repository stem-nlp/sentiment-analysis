<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/ >
		<title>Smoothed D3.js Radar Chart</title>

		<!-- Google fonts -->
		<link href='http://fonts.googleapis.com/css?family=Open+Sans:400,300' rel='stylesheet' type='text/css'>
		<link href='https://fonts.googleapis.com/css?family=Raleway' rel='stylesheet' type='text/css'>

		<!-- D3.js -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js" charset="utf-8"></script>
		
		<style>
			body {
				font-family: 'Open Sans', sans-serif;
				font-size: 11px;
				font-weight: 300;
				fill: #242424;
				text-align: center;
				text-shadow: 0 1px 0 #fff, 1px 0 0 #fff, -1px 0 0 #fff, 0 -1px 0 #fff;
				cursor: default;
			}
			
			.legend {
				font-family: 'Raleway', sans-serif;
				fill: #333333;
			}
			
			.tooltip {
				fill: #333333;
			}
			.radarChart{
				float: left;
			} 
			.radarChart2{
				float: left;
			}
			.pie{
				float: left;

		} 
		</style>
	
	</head>
	<body>

		<div class="radarChart"></div>
		<div class="radarChart2"></div>
		<div class="pie"></div>
		<script src="static/js/radarChart.js"></script>
		<script src="static/js/draw.js" ></script>
		<script>
 
      /* Radar chart design created by Nadieh Bremer - VisualCinnamon.com */
      
			////////////////////////////////////////////////////////////// 
			//////////////////////// Set-Up ////////////////////////////// 
			////////////////////////////////////////////////////////////// 

			var margin = {top: 50, right: 50, bottom: 50, left: 100},
				width = 220//Math.min(700, window.innerWidth - 10) - margin.left - margin.right,
				height = 220//Math.min(width, window.innerHeight - margin.top - margin.bottom - 20);
					
			////////////////////////////////////////////////////////////// 
			////////////////////////// Data ////////////////////////////// 
			////////////////////////////////////////////////////////////// 
			d3.json("static/json/analysis.json",function(d){
			
			//评价结果分析
				function pj(){
					var av={};
					
					for (var i in d){
						if (i!="id" && i!="content"){
							var sum=0;
							var count=0;
							
							for (var j in d[i]){
								count =count+1;
								if(d[i][j]!=-2){
									sum=sum+d[i][j];
								};
							};
							av[i]=sum/count;
						};
					};
					return av;
				};
				var pingjia;
				pingjia=pj();
			
			//感情分析
				function gq(){
					count={}
					for (var i in d){
						if (i!="id" && i!="content"){
							for (var j in d[i]){
								var c=Number(count[(d[i][j]).toString()])
								if (isNaN(c)) {c=0}; 
								count[(d[i][j]).toString()]=1+c;
								
							};
						};
					};

				return count;
				};
				ganqing=gq()
				if (isNaN(ganqing["0"])){ganqing["0"]=0};
				if (isNaN(ganqing["1"])){ganqing["1"]=0};
				if (isNaN(ganqing["-1"])){ganqing["-1"]=0};
				if (isNaN(ganqing["-2"])){ganqing["-2"]=0};

				var radar_data = [
						  [//Location
							{axis:"位置",value:pingjia.location},
							{axis:"服务",value:pingjia.service},
							{axis:"价格",value:pingjia.price},

							{axis:"环境",value:pingjia.environment},
							{axis:"菜品",value:pingjia.dish},
							{axis:"其他",value:pingjia.others},


						  ]
						];

				var radar_data2 = [
						  [//Location
							{axis:"正向感情",value:ganqing["1"]/20},
							
							{axis:"中性感情",value:ganqing["0"]/20},
							{axis:"负向感情",value:ganqing["-1"]/20},

							{axis:"感情方向不明确",value:ganqing["-2"]/20},
							
						  ]
						];

				/*var radar_data3=[];
				var tmp_data=[];
				for (var i in d){
					if (i!="id" && i!="content"){
						for (var j in d[i]){
							tmp_data.push({axis:i+"-"+j,value:d[i][j]})
						};
					};
				};
				radar_data3=[tmp_data];*/
				////////////////////////////////////////////////////////////// 
				//////////////////// Draw the Chart ////////////////////////// 
				////////////////////////////////////////////////////////////// 

				var color = d3.scale.ordinal()
					.range(["#EDC951","#CC333F","#00A0B0"]);
					
				var radarChartOptions = {
				  w: width,
				  h: height,
				  margin: margin,
				  maxValue: 1,
				  minValue: -2,
				  levels: 3,
				  labelFactor:1.5,
				  roundStrokes: true,
				  color: color
				};

				var radarChartOptions2 = {
				  w: width,
				  h: height,
				  margin: margin,
				  maxValue: 1,
				  levels: 4,
				  roundStrokes: true,
				  color: color
				};


				//Call function to draw the Radar chart
				RadarChart(".radarChart", radar_data, radarChartOptions);
				RadarChart(".radarChart2", radar_data2, radarChartOptions2);
				draw(".pie",d)

			});
		</script>
	</body>
</html>